---
layout: post
title: SQL Overview
date: 2016-09-22 12:00:00
categories: programming
comments: false
en: true
description: An Overview of SQL
keywords: "sql basics, sql cheat sheet, sql tutorial, sql, mysql, postgresql, sql essential"
authors:
    - Edgar Montano
---

## Table of contents

* toc
{:toc}

## Intro

SQL stands for Structured Query Language. It is used for creating, reading, updating, and deleting modern databases. SQL is designed to work with relational databases, which is a data store that is capable of representing relationships between different sets of data.  SQL can be divided into two major categories:

* Data Definition Langauge (DDL) - used to define tables, indexes, and relationships
* Data Manipulation Language (DML)  - used to add, query, manipulate, and delete data from tables and datasets.

## SELECT
Used for most data retrieval in SQL. An example of a simple select would be the following:

```
SELECT * FROM Country;
```

this command will select all the rows from the table Country. SQL does not gurantee that the data will be returned in a specific order, so we need a special command to specify which field we want to organize our data by.

```
SELECT * FROM Country ORDER BY Name;
```

using the Order By will sort by a specified field, in this case: Name.
count is an aggregate function.

## Insert

```
Insert INTO Customer (name, address, city, state, zip) VALUES ('john doe', '2222 spooner street', 'bedrock', 'ca', '1991');
```

## Update Data

```
UPDATE Customer SET Address = '123 Music Ave.', Zip = '98054' WHERE id = 1
SELECT * FROM Customer;
```

## Delete

```
DELETE FROM Customer WHERE id = 4;
```

## NULL
Null is a special indeterminate value, meaning no data.

## Normalized vs Denormalized
Normalized databases are designed to reduce redundancy while Denormalized databases are designed to optimize read time. Denormalizing is commonly used to create scalable systems. An example of this is teachers and courses.
In a denormalized system we would store the Teacher information directly into the Course table (such as name, email, etc),  instead of having a Foreign key embedded.

## Creating tables

```
CREATE TABLE test (
  a INTEGER,
  b TEXT  
);

INSERT INTO test VALUES (1,'a');
INSERT INTO test VALUES (2,'b');
```

## Deleting Tables

```
DROP TABLE test;
```

## Inserting rows into a table
```
INSERT INTO test ( b,c ) VALUES ( 'hello','world');
INSERT INTO test (a,b,c) SELECT id, name, description FROM item; -- inserts from query
```

## Deleting rows from a table
```
DELETE FROM test WHERE id = 1;
```

## Null
You cannot test for a = null since null is a special expression that cannot be tested against since it has no values. It is important to remember that null is not a value.

```
SELECT * FROM test WHERE a IS NULL ;
SELECT * FROM test WHERE a is NOT NULL;
```

## Constraints

```
CREATE TABLE test (a TEXT, b TEXT, c TEXT NOT NULL);
INSERT INTO table (a,b) VALUES ("a","b"); -- Yields Error since it cannot be null

CREATE TABLE test (a TEXT, b TEXT, c TEXT DEFAULT 'hello');
INSERT INTO table (a,b) VALUES ("a","b"); -- Now works

CREATE TABLE test (a TEXT UNIQUE, b TEXT, c TEXT DEFAULT 'hello');
INSERT INTO table (a,b) VALUES ("a","b");
INSERT INTO table (a,b) VALUES ("a","a"); -- Does not work due to unique constrain

CREATE TABLE test (a TEXT UNIQUE, b TEXT, c TEXT DEFAULT 'hello');
INSERT INTO table (a,b) VALUES (NULL,"b");
INSERT INTO table (a,b) VALUES (NULL,"b");  -- works since null is not a value despite constraint


```

## Alter

```
CREATE TABLE test (a TEXT, b TEXT, c TEXT);
INSERT INTO table (a,b) VALUES ("a","b");
INSERT INTO table (a,b) VALUES ("c","a");

ALTER TABLE test ADD d TEXT; -- alters table and adds new column d
```

## ID Column

```
CREATE TABLE test (
  id INTEGER PRIMARY KEY,
  a TEXT,
  b INTEGER
);

INSERT INTO test (a,b) VALUES("a",1);
INSERT INTO test (a,b) VALUES("b",2);

SELECT * FROM test;
```

## Filtering Data

```
SELECT Name, Continent FROM country
WHERE Population > 100000 OR Population IS NULL -- or operator
ORDEER BY Population DESC; -- descending order

SELECT Name, Continent FROM country
WHERE Population > 100000 AND Continent = 'Europe' -- and operator
ORDEER BY Population DESC;


SELECT Name, Continent FROM country
WHERE Name LIKE '%island%' -- matches zero or more characters, matches any with island in string
ORDEER BY Population DESC;

SELECT Name, Continent FROM country
WHERE Name LIKE '_a%' -- matches anything with the second character as an a.
ORDEER BY Population DESC;

SELECT Name, Continent FROM country
WHERE Name IN ('Europe', 'Asia') -- select to match values in list.
ORDEER BY Name; -- descending order

```


## Removing Duplicates

```
SELECT DISTINCT Continent FROM Country; -- normally sorts column in result, and simply removes duplicates

CREATE TABLE test (a INT,b INT);
INSERT INTO test (a,b) VALUES (1,2);
INSERT INTO test (a,b) VALUES (3,2);
INSERT INTO test (a,b) VALUES (661,2);
INSERT INTO test (a,b) VALUES (100,100);
INSERT INTO test (a,b) VALUES (3,4);

SELECT DISTINCT b FROM test;
SELECT DISTINCT a,b FROM test;
```

## Sorting with order by

```
Select Name from Country ORDER BY Name; -- alphabetical order
Select Name from Country ORDER BY Name DESC; -- descending order
Select Name from Country ORDER BY Name AESC; -- not normally used b/c default order is ascending.
Select Name from Country ORDER BY Continent DESC, Name AESC;  
```

## Conditional Expressions

```
SELECT
  CASE WHEN a THEN 'true' ELSE 'false' END AS boolA,
  CASE WHEN b THEN 'true' ELSE 'false' END AS boolB
  FROM test;


  SELECT
    CASE a WHEN 1 THEN 'true' ELSE 'false' END AS boolA,
    CASE b WHEN 1  THEN 'true' ELSE 'false' END AS boolB
    FROM test;
```


## Joins

When you need a result that includes related rows from multiple tables you will need a joined query. The result of an _inner join_  will include rows from both tables where the joined condition is met. The inner key word is typically omitted since this is usually the default. Outer join is less common, but still used. A _left outer join_ includes the rows where the condition is met, plus all the rows from the table on the left, where the condition is not met, similarly a right outer join includes all the rows from the table on the right. *However* right outer join is considered a special case, and not all DBMS support right joins.


```
CREATE TABLE left (id INTEGER, description TEXT);
CREATE TABLE right (id INTEGER, description TEXT);

/*
populate both tables
*/
INSERT INTO left VALUES (1,"a");
INSERT INTO left VALUES (2,"b");
INSERT INTO left VALUES (3,"c");
INSERT INTO left VALUES (4,"d");

INSERT INTO right VALUES (5,"e");
INSERT INTO right VALUES (4,"f");
INSERT INTO right VALUES (3,"g");
INSERT INTO right VALUES (2,"h");

SELECT l.description AS left, r.description AS right
  FROM left AS l
  JOIN right AS r -- outer join
    on l.id = r.id;

SELECT l.description AS left, r.description AS right
  FROM left AS l
  LEFT JOIN right AS r -- inner join
    on l.id = r.id;
```

## Finding length of string

```
SELECT Name, LENGTH(Name) As Len FROM City;
```

## Selecting part of  a string

```
SELECT SUBSTR('hello world',6);

/*
An example of substring on date
*/

SELECT released,
  SUBSTR(released, 1,4) AS year,
  SUBSTR(released, 6,2) AS month
FROM album;
```

## Removing Spaces

```
SELECT TRIM('   string   ');
SELECT LTRIM('   string   ');  -- Only left spaces are removed
SELECT RTRIM('   string   '); -- only right spaces are removed
SELECCT TRIM('..string..','.'); -- trims periods
```

## Making strings upper or lower case

```
SELECT 'StRiNg' = 'string'; -- false b/c case sensitive
SELECT LOWER('StRiNg') = LOWER('string'); -- true
SELECT UPPER('HeLlo') = UPPER('hello'); -- true
```

## Fundemental Numeric Types

* Integer
  * Integer (Precision)
  * Decimal (precision, scale)
  * Money(precision, scale) -- specialize case of decimal types
* Real - sacrafices accuracy for scale
  * Real (precision)
  * Float(precision )

An example of how real numbers sacrafices accuracy:
```
(( .1 + .2 ) * 10) = (1.0 + 3.0)
```
will yield false.


## Finding data types

```
SELECT TYPEOF(1 +1.0); --most dbms have a typeof functionality, yields real
SELECT TYPEOF('hello'); -- text
SELECT TYPEOF('hello' + 'world'); -- yields integer in some systems, some yield string.
```

## Integer Division and Remainders

```
SELECT 1/2; -- results is 0
SELECT  1.0/2; -- results is 0.5
SELECT CAST(1 AS REAL)/2 ; -- results is 0.5
SELECT 17 % 5; -- remainder of, some systems use a mod function instead of the % operator.
```

## Rounding numbers

```
SELECT ROUND(2.999999); -- results in 3.0
SELECT ROUND(2.55555,3); -- round to 3rd pos
```

## Dates

Usually represented in UTC. Most DBMS have special types to represent time.

* Date
* Time
* Datetime
* Year
* Interval

Similarly every database management system has functions specifically tasked to handle date. The following functions rather common:

* DATE()
* TIME()
* DATETIME()
* STRFTIME()

```
SELECT DATETIME('now'); -- returns current date time in utc
SELECT DATE('now');
SELECT TIME('now');

SELECT DATETIME('now','+1 day'); -- can take arthimetic time
SELECT DATETIME('now', '-1 month');
SELECT DATETIME('now', '+3 hours', '-5 months', '+1 years');

```
